#/usr/bin/bash -v

NEW_VERSION="$1"
OLD_VERSION=`cat ../.version`

if [ -z "$1" ]
then

    echo "please specify new version: $0 VERSION"
    echo "Current version: $OLD_VERSION"
    
else
    echo "Building release $NEW_VERSION"
    
    echo "$NEW_VERSION" > ../.version
    
    sed 's/"version": "$NEW_VERSION",/"version": "$NEW_VERSION",/g' package.json > package.json
    sed 's/@version $NEW_VERSION/@version $NEW_VERSION/g' src/clone.js > src/clone.js
    
    ./build.api-doc
    ./build.cdn
    
    ./deploy.push-build
    #./deploy.npm-package
    
    cat ../tmp/last-build.log >> ../CHANGELOG.md
fi